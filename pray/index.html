
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="keywords" content="Masalma Masalma.com" />
    <meta name="description" content="Masalma Masalma.com" />
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
    <meta name="robots" content="index,follow" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Home, Masalma.com" />
    <meta property="og:description" content="Masalma Masalma.com" />
    <meta property="og:url" content="https://masalma.com/" />
    <meta property="og:site_name" content="Masalma.com" />
    <link rel="canonical" href="https://masalma.com/" />

    <title>Masalma - Ramadan Countdown</title>
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W1R7TB87PT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-W1R7TB87PT');
    </script>
    
    <!--<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">-->
    <link rel="stylesheet" type="text/css" href="../bootstrap.min.css">

    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>-->
    <script type="text/javascript" src="../bootstrap.bundle.min.js"></script>

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>-->
    <script type="text/javascript" src="../jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../custom.css">

    <script src="adhan.umd.min.js"></script> <!-- from https://github.com/batoulapps/adhan-js -->
    <script src="moment-with-locales.min.js"></script>
    <script src="moment-timezone-with-data-10-year-range.min.js"></script>



  </head>



  <body onload="mytime()">
    <script type="text/javascript">

      var dLatitude = 43.4590806;
      var dLongitude = -80.5355996;
      //var dLongitude = -0.3;

function mytime() {
var d=new Date();
ap="am";
h=d.getHours();
m=d.getMinutes();
s=d.getSeconds();
if (h>11) { ap = "pm"; }
if (h>12) { h = h-12; }
if (h==0) { h = 12; }
if (m<10) { m = "0" + m; }
if (s<10) { s = "0" + s; }
document.getElementById('timehere').innerHTML=h + ":" + m + ":" + s + " " + ap;
t=setTimeout('mytime()',500);
}



      var getUrlParameter = function getUrlParameter(sParam) {
          var sPageURL = window.location.search.substring(1),
              sURLVariables = sPageURL.split('&'),
              sParameterName,
              i;
      
          for (i = 0; i < sURLVariables.length; i++) {
              sParameterName = sURLVariables[i].split('=');
      
              if (sParameterName[0] === sParam) {
                  return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
              }
          }
          return false;
      };
      
      

      var latitude = getUrlParameter('latitude');
      var longitude = getUrlParameter('longitude');
      

      
      console.log("URL latitude = " + latitude);
      console.log("URL longitude = " + longitude);

/*
      function beep(freq = 660, duration = 90, vol = 50) {
        var context = new(window.AudioContext || window.webkitAudioContext);
        const oscillator = context.createOscillator();
        const gain = context.createGain();
        gain.gain.setValueAtTime(0, context.currentTime);
        gain.gain.linearRampToValueAtTime(1, context.currentTime + 0.002);
        oscillator.connect(gain);
        oscillator.frequency.value = freq;
        oscillator.type = "square";
        gain.connect(context.destination);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + duration * .001);
        oscillator.onended = () => context.close();
      }

*/


      function prayerName(prayer) {
        if (prayer == adhan.Prayer.Fajr) {
          return "Fajr";
        } else if (prayer == adhan.Prayer.Sunrise) {
          return "Sunrise";
        } else if (prayer == adhan.Prayer.Dhuhr) {
          return "Dhuhr";
        } else if (prayer == adhan.Prayer.Asr) {
          return "Asr";
        } else if (prayer == adhan.Prayer.Maghrib) {
          return "Maghrib";
        } else if (prayer == adhan.Prayer.Isha) {
          return "Isha";
        } else if (prayer == adhan.Prayer.None) {
          return "None";
        }
      }





      function useLocation(lat, long) {

        const coordinates = new adhan.Coordinates(lat, long);
        // ToDo: get date + 1 for next fajr


        var CalculationMethod = getUrlParameter('CalculationMethod');
        console.log("URL CalculationMethod = " + CalculationMethod);

        var fasting = getUrlParameter('fasting');
        console.log("URL fasting = " + fasting);

        var madhab = getUrlParameter('madhab');
        console.log("URL madhab = " + madhab);

        var useDate = getUrlParameter('useDate');
        console.log("URL useDate = " + useDate);


        if (useDate) {
          var date = new Date(useDate);
          var nextDate = new Date(useDate);
        } else {
          var date = new Date();
          var nextDate = new Date();
        }
        nextDate.setDate(nextDate.getDate() + 1);




        var tz = Intl.DateTimeFormat().resolvedOptions().timeZone;

        if (CalculationMethod) {
          if (CalculationMethod.includes("NorthAmerica")) {
            var params = adhan.CalculationMethod.NorthAmerica();
          } else if (CalculationMethod.includes("Dubai")) {
            var params = adhan.CalculationMethod.Dubai();
          } else if (CalculationMethod.includes("Egyptian")) {
            var params = adhan.CalculationMethod.Egyptian();
          } else if (CalculationMethod.includes("Karachi")) {
            var params = adhan.CalculationMethod.Karachi();
          } else if (CalculationMethod.includes("UmmAlQura")) {
            var params = adhan.CalculationMethod.UmmAlQura();
          } else if (CalculationMethod.includes("Qatar")) {
            var params = adhan.CalculationMethod.Qatar();
          } else if (CalculationMethod.includes("Singapore")) {
            var params = adhan.CalculationMethod.Singapore();
          } else if (CalculationMethod.includes("Tehran")) {
            var params = adhan.CalculationMethod.Tehran();
          } else if (CalculationMethod.includes("Turkey")) {
            var params = adhan.CalculationMethod.Turkey();
          } else if (CalculationMethod.includes("MoonsightingCommittee")) {
            var params = adhan.CalculationMethod.MoonsightingCommittee();
          } else if (CalculationMethod.includes("MuslimWorldLeague")) {
            var params = adhan.CalculationMethod.MuslimWorldLeague();
          } else if (CalculationMethod.includes("Kuwait")) {
            var params = adhan.CalculationMethod.Kuwait();
          } else {
            var params = adhan.CalculationMethod.Other(); // Or MoonsightingCommittee or MuslimWorldLeague or Kuwait?
          }
        } else {
          if (tz.includes("America")) {
            var params = adhan.CalculationMethod.NorthAmerica();
          } else if (tz.includes("Dubai")) {
            var params = adhan.CalculationMethod.Dubai();
          } else if (tz.includes("Africa")) {
            var params = adhan.CalculationMethod.Egyptian();
          } else if (tz.includes("Karachi")) {
            var params = adhan.CalculationMethod.Karachi();
          } else if (tz.includes("Riyadh")) {
            var params = adhan.CalculationMethod.UmmAlQura();
          } else if (tz.includes("Qatar")) {
            var params = adhan.CalculationMethod.Qatar();
          } else if (tz.includes("Singapore")) {
            var params = adhan.CalculationMethod.Singapore();
          } else if (tz.includes("Tehran")) {
            var params = adhan.CalculationMethod.Tehran();
          } else if (tz.includes("Istanbul")) {
            var params = adhan.CalculationMethod.Turkey();
          } else {
            var params = adhan.CalculationMethod.Other(); // Or MoonsightingCommittee or MuslimWorldLeague or Kuwait?
          }
        }

        if (madhab == "Hanafi") {
          params.madhab = adhan.Madhab.Hanafi;
        } else {
          params.madhab = adhan.Madhab.Shafi;
        }
        

        var prayerTimes = new adhan.PrayerTimes(coordinates, date, params);
        var nextPrayerTimes = new adhan.PrayerTimes(coordinates, nextDate, params);

        //var sunnahTimes = new adhan.SunnahTimes(prayerTimes);


        var xCountDownDate = moment(nextPrayerTimes.fajr);
        var xxCountDownDate = moment(nextPrayerTimes.timeForPrayer(nextPrayerTimes.nextPrayer()));
        
        var pastMidnight = false;
        
        console.log(prayerTimes.nextPrayer());
        console.log(prayerTimes.timeForPrayer(prayerTimes.nextPrayer()));
        console.log(Date());
        
        if (prayerTimes.nextPrayer() == "fajr") {
          console.log("next is fajir...");
          console.log("Are we before or after midnight...");
          console.log(moment(date).format('MMMM DD, YYYY'));
          console.log(moment(prayerTimes.timeForPrayer(prayerTimes.nextPrayer())).format('MMMM DD, YYYY'));
          if (moment(date).format('MMMM DD, YYYY') == moment(prayerTimes.timeForPrayer(prayerTimes.nextPrayer())).format('MMMM DD, YYYY')) {
            console.log("We are past midnight");
            pastMidnight = true;
            //var nextPrayerTimes = new adhan.PrayerTimes(coordinates, date, params);
            xCountDownDate = moment(prayerTimes.fajr);
            xxCountDownDate = moment(prayerTimes.timeForPrayer(prayerTimes.nextPrayer()));
          } else {
            console.log("We are before midnight");
            pastMidnight = false;
            //var nextPrayerTimes = new adhan.PrayerTimes(coordinates, nextDate, params);
            xCountDownDate = moment(nextPrayerTimes.fajr);
            xxCountDownDate = moment(nextPrayerTimes.timeForPrayer(nextPrayerTimes.nextPrayer()));
          }
        }
        
        
        
        
        
        console.log(moment(nextDate).format('MMMM DD, YYYY'));
        console.log();
        console.log();



        var star = ["", "", "", "", "", ""]
        var aStar = "> ";
        //var cp = prayerName(prayerTimes.currentPrayer());
        var np = prayerName(prayerTimes.nextPrayer());

        //console.log(np);
        switch (np) {
          case "Fajr":
            if (pastMidnight) {
              star[0] = aStar;
            } else {
              star[5] = aStar;
            }
            break;
          case "Sunrise":
          case "Dhuhr":
            star[1] = aStar;
            break;
          case "Asr":
            star[2] = aStar;
            break;
          case "Maghrib":
            star[3] = aStar;
            break;
          case "Isha":
            star[4] = aStar;
            break;
        }
        




        //console.log(new Intl.DateTimeFormat('en-TN-u-ca-islamic', {day: 'numeric', month: 'long',weekday: 'long',year : 'numeric'}).format(Date.now()));
        var higriMonth = new Intl.DateTimeFormat('en-TN-u-ca-islamic', {month: 'long',}).format(Date.now());

console.log("###DEBUG### - here...");
        
console.log(lat +  ", " + long);

        $("#PTDate").html(new Intl.DateTimeFormat('en-TN-u-ca-islamic', {day: 'numeric', month: 'long',weekday: 'long',year : 'numeric'}).format(Date.now()) + " - " + moment(date).format('MMMM DD, YYYY'));
        //$("#fajr").html(star[0] + moment(prayerTimes.fajr).tz('America/New_York').format('h:mm A'));

        //$("#fajr").html(star[0] + moment(prayerTimes.fajr).format('h:mm A'));
        document.getElementById("fajr").innerHTML = star[0] + moment(prayerTimes.fajr).format('h:mm A');
        
        $("#sunrise").html(moment(prayerTimes.sunrise).format('h:mm A'));
        $("#dhuhr").html(star[1] + moment(prayerTimes.dhuhr).format('h:mm A'));
        $("#asr").html(star[2] + moment(prayerTimes.asr).format('h:mm A'));
        $("#maghrib").html(star[3] + moment(prayerTimes.maghrib).format('h:mm A'));
        $("#isha").html(star[4] + moment(prayerTimes.isha).format('h:mm A'));
        $("#nextfajr").html(star[5] + moment(nextPrayerTimes.fajr).format('h:mm A'));
        //$("#midnight").html(moment(sunnahTimes.middleOfTheNight).format('MMMM DD, h:mm A'));
        //$("#lastthird").html(moment(sunnahTimes.lastThirdOfTheNight).format('MMMM DD, h:mm A'));
        $("#qibla").html(Math.round(adhan.Qibla(coordinates) * 100) / 100 + "&deg;");
        $("#latLong").html(lat +  ", " + long);
        //https://www.google.com/maps/@43.5014251,-85.2939009,10z

console.log("###DEBUG### - after here...");



        if (fasting == 1 || (!fasting && higriMonth == "Ramadan")) {
          console.log(higriMonth);
          console.log(prayerTimes.nextPrayer());
          if (prayerTimes.nextPrayer() == 'sunrise' || prayerTimes.nextPrayer() == 'dhuhr' || prayerTimes.nextPrayer() == 'asr' || prayerTimes.nextPrayer() == 'maghrib') {
            console.log("next is maghrib");
            var countDownDate = moment(prayerTimes.maghrib);
            var nextP = "Iftar";
          } else {
            console.log("next is fajr");
            var countDownDate = xCountDownDate; //moment(nextPrayerTimes.fajr);
            var nextP = "Sahour ends";
          }
        } else {
          var countDownDate = moment(prayerTimes.timeForPrayer(prayerTimes.nextPrayer()));
          var nextP = prayerName(prayerTimes.nextPrayer());
        }
        
        if (nextP == "Fajr") {
          var countDownDate = xxCountDownDate; //moment(nextPrayerTimes.timeForPrayer(nextPrayerTimes.nextPrayer()));//countDownDate + (24 * 60 * 60 * 1000);
        }


        var x = setInterval(function() {
          if (useDate) {
            var now = new Date(useDate).getTime();
          } else {
            var now = new Date().getTime();
          }
          var distance = countDownDate - now;
          //console.log("countDownDate = " + countDownDate);
          //console.log("now = " + now);

          var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
          var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
          document.getElementById("countDown").innerHTML = nextP + " in<br />" + hours + "h "
          + minutes + "m " + seconds + "s ";// + distance;

          if (distance < 0) {
            clearInterval(x);
            $('body').css('background-color', 'lightgreen');
            document.getElementById("countDown").innerHTML = "Done...";
            //window.location.reload();
            setTimeout(location.reload.bind(location), 60000);



            //beep();
          }
        }, 1000);


      }
      
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const latitude = position.coords.latitude;
              const longitude = position.coords.longitude;
              useLocation(latitude, longitude);
            },
            (error) => {
              console.error("Error getting location:", error.message);
              console.log("useLocation(" + dLatitude +", " + dLongitude + ");");
              useLocation(dLatitude, dLongitude);
            }
          );
        } else {
          console.warn("Geolocation is not supported by this browser.");
          useLocation(dLatitude, dLongitude);
        }
      }
      

      if (latitude && longitude) {
        console.log("useLocation(" + latitude +", " + longitude + ");");
        useLocation(latitude, longitude);
      } else {
        getLocation();
      }






    </script>


    <main role="main">


      <div class="container">
        <h1 class="fw-bolder text-center text-top display-1">
          <p id="countDown">Countdown<br />Timer</p>
        </h1>
        <h4 class="fw-normal fst-italic">
          Prayer times for <p style="display:inline" id="PTDate">date</p>
        </h4>
      </div>


      <div class="container">
        <div class="row">
          <div class="col" style="position:fixed;top:0;left:0;">
            <p style="display:inline; background-color: lightgray;" id="timehere"></p>
          </div>
        </div>
      </div>


      <div class="container">



        <div class="container" style="font-size: 5vw;">


          <div class="row">
            <div class="col text-end">
              Fajr
            </div>
            <div class="col" id="fajr">
              fajr time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Sunrise
            </div>
            <div class="col" id="sunrise">
              sunrise time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Dhuhr
            </div>
            <div class="col" id="dhuhr">
              dhuhr time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Asr
            </div>
            <div class="col" id="asr">
              asr time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Maghrib
            </div>
            <div class="col" id="maghrib">
              maghrib time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Isha
            </div>
            <div class="col" id="isha">
              isha time
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Next Fajr
            </div>
            <div class="col" id="nextfajr">
              nextfajr time
            </div>
          </div>


          <div class="row">
            <div class="col">
              <br />
            </div>
          </div>

          <div class="row">
            <div class="col text-end">
              Qibla Direction
            </div>
            <div class="col" id="qibla">
              qibla Direction
            </div>
          </div>

        </div>

        <div class="row" style="font-size: 2vw;">
          <div class="col">
            Lat/Long <p style="display:inline" id="latLong">lat/long</p>
          </div>
        </div>

        <div class="container" style="font-size: 1.5vw;">
          <div class="row">
            <div class="col">
              <a href="options.html">Options</a>
            </div>
          </div>

          <div class="row">
            <div class="col">
              Please check you local masjid for official times
            </div>
          </div>
        </div>

      </div>
    </main>
  
    <div class="navbar fixed-bottom ms-3 me-3 footer-text"><small><span>© JM</span></small></div>
  
  </body>
</html>







